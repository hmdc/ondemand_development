{
  "version": 3,
  "sources": ["../../javascript/support_ticket.js"],
  "sourcesContent": ["'use strict';\n\njQuery(function (){\n    let attachmentIdCounter = 0;\n\n    function createId() {\n        return `attachment_id_${++attachmentIdCounter}`;\n    }\n\n    function fileSizeToString(number) {\n        if(number < 1024) {\n            return number + \"bytes\";\n        } else if(number >= 1024 && number < 1048576) {\n            return (number/1024).toFixed(1) + \"KB\";\n        } else if(number >= 1048576) {\n            return (number/1048576).toFixed(1) + \"MB\";\n        }\n    }\n\n    function validateForm(event) {\n        const validForm = $(\"#new_support_ticket\")[0].reportValidity();\n        if(!validForm) {\n            event.preventDefault();\n            return;\n        }\n\n        //SHOW FULL PAGE SPINNER\n        $(\"body\").addClass(\"modal-open\");\n        $(\"#full-page-spinner\").removeClass('d-none');\n    }\n\n    function clearAttachmentsError() {\n        const $errorElement = $(\"#attachments_error\");\n        $errorElement.parent().removeClass(\"has-error\");\n        $errorElement.remove();\n    }\n\n    function showAttachmentsError(message) {\n        const $attachmentsElement = $(\"[data-toggle='attachments-error']\");\n        $attachmentsElement.parent().addClass(\"has-error\");\n        $attachmentsElement.after(`<div class=\"help-block\" id=\"attachments_error\">${message}</div>`);\n    }\n\n    function deleteAttachment(event) {\n        clearAttachmentsError();\n        const attachmentContainerId = event.currentTarget.getAttribute(\"data-attachment-container\");\n        $(`#${attachmentContainerId}`).remove();\n    }\n\n    function updateAttachmentContent(event) {\n        clearAttachmentsError();\n        const $fileElement = $(event.currentTarget);\n        const files = $fileElement.prop('files');\n        if (!files || files.length === 0) {\n            return;\n        }\n\n        const fileInfo = files[0];\n        if(fileInfo.size > SUPPORT_TICKET_RESTRICTIONS.max_size) {\n            createAttachmentElement((newAttachment) => {\n                $fileElement.parent().replaceWith(newAttachment);\n            });\n            const message = SUPPORT_TICKET_MESSAGES[\"size.attachments\"].replace(\"%{max}\", fileSizeToString(SUPPORT_TICKET_RESTRICTIONS.max_size)).replace(\"%{size}\", fileSizeToString(fileInfo.size));\n            showAttachmentsError(message);\n            return;\n        }\n\n        const fileInputId = event.currentTarget.id;\n        $(`label[for='${fileInputId}']`).text(`Selected file: ${fileInfo.name} (${fileSizeToString(fileInfo.size)}).`);\n    }\n\n    function createAttachmentElement(attachmentPlacementCallback) {\n        const newAttachmentContainerId = createId();\n        const newFileInputId = createId();\n        const newAttachment =\n        `<div class=\"attachment-input\" id=\"${newAttachmentContainerId}\">\n           <div class=\"form-control attachment-input-content\">\n              <label class=\"attachment-file-label\" for=\"${newFileInputId}\">No file selected</label>\n              <span class=\"attachment-delete\" data-toggle=\"attachment-delete\" data-attachment-container=\"${newAttachmentContainerId}\" title=\"Delete attachment\"><i class=\"fas fa-trash-alt\"></i></span>\n           </div>\n           <input class=\"form-control\"  type=\"file\" name=\"support_ticket[attachments][]\" id=\"${newFileInputId}\">\n        </div>`;\n\n        attachmentPlacementCallback(newAttachment);\n        $(\"input[type='file']\").on(\"change\", updateAttachmentContent);\n        $(\"[data-toggle='attachment-delete']\").on(\"click\", deleteAttachment);\n        return newAttachment;\n    }\n\n    function addAttachment() {\n        clearAttachmentsError();\n        if($(\"input[type='file']\").length >= SUPPORT_TICKET_RESTRICTIONS.max_items ) {\n            showAttachmentsError(SUPPORT_TICKET_MESSAGES[\"items.attachments\"]);\n            return;\n        }\n\n        createAttachmentElement((newAttachment) => {\n            $(\"#attachments-container\").append(newAttachment);\n        });\n    }\n\n    $(function() {\n        $(\"[data-toggle='attachments-add']\").on(\"click\", addAttachment);\n        $(\"#new_support_ticket\").submit(validateForm);\n    });\n\n});"],
  "mappings": ";AAEA,OAAO,WAAW;AACd,MAAI,sBAAsB;AAE1B,WAAS,WAAW;AAChB,WAAO,iBAAiB,EAAE;AAAA,EAC9B;AAEA,WAAS,iBAAiB,QAAQ;AAC9B,QAAG,SAAS,MAAM;AACd,aAAO,SAAS;AAAA,IACpB,WAAU,UAAU,QAAQ,SAAS,SAAS;AAC1C,cAAQ,SAAO,MAAM,QAAQ,CAAC,IAAI;AAAA,IACtC,WAAU,UAAU,SAAS;AACzB,cAAQ,SAAO,SAAS,QAAQ,CAAC,IAAI;AAAA,IACzC;AAAA,EACJ;AAEA,WAAS,aAAa,OAAO;AACzB,UAAM,YAAY,EAAE,qBAAqB,EAAE,GAAG,eAAe;AAC7D,QAAG,CAAC,WAAW;AACX,YAAM,eAAe;AACrB;AAAA,IACJ;AAGA,MAAE,MAAM,EAAE,SAAS,YAAY;AAC/B,MAAE,oBAAoB,EAAE,YAAY,QAAQ;AAAA,EAChD;AAEA,WAAS,wBAAwB;AAC7B,UAAM,gBAAgB,EAAE,oBAAoB;AAC5C,kBAAc,OAAO,EAAE,YAAY,WAAW;AAC9C,kBAAc,OAAO;AAAA,EACzB;AAEA,WAAS,qBAAqB,SAAS;AACnC,UAAM,sBAAsB,EAAE,mCAAmC;AACjE,wBAAoB,OAAO,EAAE,SAAS,WAAW;AACjD,wBAAoB,MAAM,kDAAkD,eAAe;AAAA,EAC/F;AAEA,WAAS,iBAAiB,OAAO;AAC7B,0BAAsB;AACtB,UAAM,wBAAwB,MAAM,cAAc,aAAa,2BAA2B;AAC1F,MAAE,IAAI,uBAAuB,EAAE,OAAO;AAAA,EAC1C;AAEA,WAAS,wBAAwB,OAAO;AACpC,0BAAsB;AACtB,UAAM,eAAe,EAAE,MAAM,aAAa;AAC1C,UAAM,QAAQ,aAAa,KAAK,OAAO;AACvC,QAAI,CAAC,SAAS,MAAM,WAAW,GAAG;AAC9B;AAAA,IACJ;AAEA,UAAM,WAAW,MAAM;AACvB,QAAG,SAAS,OAAO,4BAA4B,UAAU;AACrD,8BAAwB,CAAC,kBAAkB;AACvC,qBAAa,OAAO,EAAE,YAAY,aAAa;AAAA,MACnD,CAAC;AACD,YAAM,UAAU,wBAAwB,oBAAoB,QAAQ,UAAU,iBAAiB,4BAA4B,QAAQ,CAAC,EAAE,QAAQ,WAAW,iBAAiB,SAAS,IAAI,CAAC;AACxL,2BAAqB,OAAO;AAC5B;AAAA,IACJ;AAEA,UAAM,cAAc,MAAM,cAAc;AACxC,MAAE,cAAc,eAAe,EAAE,KAAK,kBAAkB,SAAS,SAAS,iBAAiB,SAAS,IAAI,KAAK;AAAA,EACjH;AAEA,WAAS,wBAAwB,6BAA6B;AAC1D,UAAM,2BAA2B,SAAS;AAC1C,UAAM,iBAAiB,SAAS;AAChC,UAAM,gBACN,qCAAqC;AAAA;AAAA,0DAEa;AAAA,2GACiD;AAAA;AAAA,+FAEZ;AAAA;AAGvF,gCAA4B,aAAa;AACzC,MAAE,oBAAoB,EAAE,GAAG,UAAU,uBAAuB;AAC5D,MAAE,mCAAmC,EAAE,GAAG,SAAS,gBAAgB;AACnE,WAAO;AAAA,EACX;AAEA,WAAS,gBAAgB;AACrB,0BAAsB;AACtB,QAAG,EAAE,oBAAoB,EAAE,UAAU,4BAA4B,WAAY;AACzE,2BAAqB,wBAAwB,oBAAoB;AACjE;AAAA,IACJ;AAEA,4BAAwB,CAAC,kBAAkB;AACvC,QAAE,wBAAwB,EAAE,OAAO,aAAa;AAAA,IACpD,CAAC;AAAA,EACL;AAEA,IAAE,WAAW;AACT,MAAE,iCAAiC,EAAE,GAAG,SAAS,aAAa;AAC9D,MAAE,qBAAqB,EAAE,OAAO,YAAY;AAAA,EAChD,CAAC;AAEL,CAAC;",
  "names": []
}
