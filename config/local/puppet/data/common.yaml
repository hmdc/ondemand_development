# /etc/puppetlabs/code/environments/production/data/common.yaml
#openondemand::repo_nightly: true
#openondemand::manage_dependency_repos: false
#openondemand::repo_release: 'latest'
#openondemand::repo_release: '2.0'
#openondemand::ondemand_package_ensure: '2.0.29-1.el8'
openondemand::manage_dependency_repos: false
#openondemand::repo_release: '3.0'
#openondemand::ondemand_package_ensure: '3.0.3-1.el8'
openondemand::repo_release: '3.1'
openondemand::ondemand_package_ensure: '3.1.4-1.el8'
openondemand::ondemand_dex_package_ensure: 'absent'

#openondemand::servername: 'localhost'
openondemand::declare_apache: false
apache::default_vhost: false

#openondemand::servername: 'ood.com'
openondemand::server_aliases: ['ood.com', 'localhost', 'team1.local.com', 'team2.local.com', 'team3.local.com']
openondemand::security_csp_frame_ancestors: 'https://*.local.com'
#openondemand::use_rewrites: true

## nginx_stage.yml config section
openondemand::nginx_stage_ondemand_title: null
openondemand::nginx_stage_min_uid: 500
openondemand::nginx_stage_app_root:
  dev: "~%{literal('%')}{owner}/%{literal('%')}{portal}/dev/%{literal('%')}{name}"
  usr: "/var/www/ood/apps/usr/%{literal('%')}{owner}/gateway/%{literal('%')}{name}"
  sys: "/var/www/ood/apps/sys/%{literal('%')}{name}"

openondemand::host_regex: 'slurmctld|c(1|2)'
openondemand::node_uri: '/node'
openondemand::rnode_uri: '/rnode'
openondemand::ssl:
 - 'SSLCertificateFile "/etc/puppetlabs/code/environments/production/files/apache/sid_development.crt"'
 - 'SSLCertificateKeyFile "/etc/puppetlabs/code/environments/production/files/apache/sid_development.key"'
# BASIC AUTH
openondemand::auth_type: 'Basic'
openondemand::auth_configs:
 - 'AuthName "private"'
 - 'AuthDBMUserFile "/etc/httpd/.htpasswd.dbm"'
 - 'AuthBasicProvider dbm'
 - 'RequestHeader unset Authorization'
 - 'Require valid-user'

# This can be used to replace the logout_uri and logout_redirect
openondemand::custom_vhost_directives:
  - 'RewriteRule ^/logout$ /oidc?logout=https://%{literal("%")}{HTTP_HOST} [R=301,L]'
  - '# 300 => 5 MINUTES'
  - 'TimeOut 300'
  - '# FOR FASSE ONLY - SERVICENOW PROXY'
  - 'ProxyRemote https://harvard.service-now.com http://rcproxy.rc.fas.harvard.edu:3128'
  - 'SSLProxyEngine on'
  - '<Location "/api/now">'
  - '  ProxyPass "https://harvard.service-now.com/api/now/"'
  - '  ProxyPassReverse "https://harvard.service-now.com/api/now/"'
  - '  RequestHeader set x-sn-apikey "%{lookup("secrets::ondemand::snow_api_key")}"'
  - '</Location>'

# "guest" = 5136503cc611227c0183e96598c4f706
# "troubleshooting" = 4e7017196fc5c100a54fa981be3ee4c9
# "FAS RC - IQSS Support" = 091302291b9302509ebaca262a4bcb21
# "FAS Research Computing Services > IQSS Support > IQSS Triage" = b63f3ded1b5302509ebaca262a4bcbfe
profile::openondemand::ood_support_ticket::server: 'https://localhost'
profile::openondemand::ood_support_ticket::custom_content:
  servicenow_api:
    map:
      u_email_source: "email"
      watch_list: "cc"
    payload:
      caller_id: "5136503cc611227c0183e96598c4f706"
      u_category: "4e7017196fc5c100a54fa981be3ee4c9"
      contact_type: "External System"
      assignment_group: "091302291b9302509ebaca262a4bcb21"
      u_business_service: "b63f3ded1b5302509ebaca262a4bcbfe"

openondemand::clusters:
  dev-cluster:
    source: '/etc/puppetlabs/code/environments/production/files/dev-cluster.yml'

openondemand::install_apps:
  bc_desktop:
    mode: '0700'
  RStudio:
    source: '/etc/puppetlabs/code/environments/production/files/apps/RStudio'
    manage_package: false
  rdesktop:
    source: '/etc/puppetlabs/code/environments/production/files/apps/rdesktop'
    manage_package: false